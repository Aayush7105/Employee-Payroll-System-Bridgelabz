# Employee Payroll System

An employee payroll dashboard built with **Node.js + Express + EJS** using a local **JSON file** as storage.

## 1. Project Overview

This project is a server-rendered web application for managing employee payroll records.
It supports:

1. Viewing a payroll dashboard with summary cards.
2. Adding employee records.
3. Editing employee records.
4. Deleting employee records.
5. Fetching employee data through JSON API endpoints.

The application uses `employees.json` as a lightweight data store. Data is loaded into memory at startup and written back to the JSON file whenever records are changed.

## 2. Tech Stack (What Is Used and Why)

1. Node.js
   Used to run the JavaScript backend server.

2. Express (v5)
   Used as the web framework for:

- Routing (`GET`, `POST`, `DELETE`)
- Middleware setup
- Request/response handling

3. EJS (Embedded JavaScript Templates)
   Used for server-side HTML rendering:

- `index.ejs` dashboard page
- `add.ejs` add employee form
- `edit.ejs` edit employee form

4. fs/promises (Node built-in)
   Used in `modules/fileHandler.js` for async file read/write operations.

5. Plain JSON file (`employees.json`)
   Used as the persistence layer instead of a database.

6. HTML/CSS + small client-side JavaScript
   Used for UI rendering, styling, and delete action (`fetch` call).

## 3. Folder and File Structure

```text
Employee-Payroll-System/
|-- server.js
|-- employees.json
|-- modules/
|   `-- fileHandler.js
|-- views/
|   |-- index.ejs
|   |-- add.ejs
|   `-- edit.ejs
|-- public/
|   |-- style.css
|   `-- icons/
|-- package.json
`-- README.md
```

### Important files

1. `server.js`

- Main Express app
- Route definitions
- In-memory employee array
- Business logic for add/edit/delete

2. `modules/fileHandler.js`

- Reusable async helpers:
  - `readFile(filePath)`
  - `writeFile(filePath, data)`

3. `employees.json`

- Current employee records persisted on disk.

4. `views/*.ejs`

- Server-rendered pages.

5. `public/style.css`

- UI styling and responsive layout rules.

## 4. Data Model

Each employee record has this structure:

```json
{
  "id": 1,
  "name": "Aayush",
  "position": "Software Engineer",
  "department": ["IT", "HR"],
  "salary": 70000
}
```

### Field details

1. `id` (number)

- Unique identifier.
- Generated by server logic.

2. `name` (string)

- Employee name.

3. `position` (string)

- Job role.

4. `department` (array|string)

- In forms, it is collected from a multi-select and normalized to an array.
- Existing JSON may still contain string values.

5. `salary` (number)

- Basic salary used for payroll calculations.

## 5. End-to-End Runtime Flow

1. Server starts and executes an async IIFE in `server.js`.
2. `readFile("./employees.json")` loads data into in-memory `employees`.
3. Express listens on `http://localhost:3000`.
4. Read operations (`GET`) use in-memory data.
5. Write operations (`POST`, `DELETE`) update in-memory data first, then persist with `writeFile`.
6. UI pages are rendered using EJS templates with the latest array.

## 6. Route-Level Explanation (All Major Functions)

### App setup and middleware

1. `app.use(express.static("public"))`

- Serves CSS and icons from `/public`.

2. `app.use(express.urlencoded({ extended: true }))`

- Parses HTML form data (`application/x-www-form-urlencoded`).

3. `app.use(express.json())`

- Parses JSON request bodies for API routes.

4. `app.set("view engine", "ejs")`

- Enables EJS as the template engine.

### Helper function

1. `getNextID()`

- Finds the next available employee ID.
- Logic:
  - If no employees, return `1`.
  - Build sorted list of existing IDs.
  - Return first missing ID gap.
  - If no gaps, return `maxId + 1`.

### Page routes

1. `GET /`

- Sorts employees by `id`.
- Renders `views/index.ejs`.

2. `GET /add`

- Renders add employee form (`views/add.ejs`).

3. `GET /edit/:id`

- Finds employee by route param `id`.
- Renders edit form with existing values or returns `404`.

### Form submission routes

1. `POST /add`

- Reads form fields from `req.body`.
- Builds new employee object.
- Converts department to array when needed.
- Converts salary string to number using `parseFloat`.
- Saves to array and persists to `employees.json`.
- Redirects to `/`.

2. `POST /edit/:id`

- Finds employee by `id`.
- Replaces object at that index with updated values.
- Persists changes to file.
- Redirects to `/` or returns `404`.

### API routes

1. `GET /employees`

- Returns sorted employee list as JSON.

2. `GET /employees/:id`

- Returns one employee JSON by ID or `404`.

3. `POST /employees`

- Intended to create employee from JSON body.
- Assigns a unique ID using `getNextID()` (starting from `1`) before saving.

4. `DELETE /delete/:id`

- Deletes employee by ID using `findIndex` + `splice`.
- Persists file and returns JSON success/error message.

## 7. EJS Template and Frontend Logic

### `views/index.ejs`

1. Uses EJS expressions to calculate dashboard metrics:

- Total employees
- Total basic salary
- Total tax (12%)
- Total net salary
- Average salary

2. Uses `forEach` loop to render employee rows.

3. Calculates row-level values:

- `tax = salary * 0.12`
- `netSalary = salary - tax`

4. Defines browser function `deleteEmployee(id)`:

- Shows confirm dialog.
- Sends `fetch(..., { method: "DELETE" })`.
- Reloads page after success.

### `views/add.ejs` and `views/edit.ejs`

1. HTML forms submit to backend routes.
2. Department field is multi-select.
3. Edit form pre-fills current values and selected departments.

## 8. JavaScript and Backend Topics Used

1. ES Modules

- `import ... from ...` syntax enabled by `"type": "module"`.

2. Async/Await

- Used for all file I/O operations.

3. Error handling

- `try/catch` around read/write operations and mutation routes.

4. Array methods

- `map`, `sort`, `find`, `findIndex`, `forEach`, `reduce`, `splice`, `includes`.

5. Data parsing and normalization

- `parseInt` for IDs.
- `parseFloat` for salary.
- `Array.isArray` to normalize departments.

6. HTTP methods and REST style patterns

- `GET`, `POST`, `DELETE`.

7. Server-side rendering (SSR)

- Dynamic HTML generated on server using EJS templates.

8. Static asset serving

- CSS/icons served via `express.static`.

## 9. Payroll Calculation Logic

1. Tax rate

- Flat 12%: `tax = salary * 0.12`

2. Net salary

- `net = salary - tax`

3. Dashboard totals

- Calculated with `reduce` over employee array.

4. Average salary

- `sum(salary) / employeeCount`

## 10. How To Run

1. Install dependencies:

```bash
npm install
```

2. Start server:

```bash
node server.js
```

3. Open in browser:

```text
http://localhost:3000
```

## 12. Suggested Improvements

1. Keep a single shared ID generator for all create routes.
2. Add input validation (schema-based validation like Joi/Zod).
3. Normalize `department` to always be an array.
4. Handle zero-employee average safely.
5. Add a `start` script to `package.json`.
6. Add tests for routes and utility functions.
7. Move persistence from JSON file to a database (SQLite/PostgreSQL/MongoDB) for scaling.
